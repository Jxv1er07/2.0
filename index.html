<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdminPro - Gesti√≥n Empresarial</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #ffffff; min-height: 100vh; padding-bottom: 70px; }
    .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .auth-card { background: white; border-radius: 24px; padding: 40px 30px; max-width: 400px; width: 100%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideUp 0.5s ease; }
    @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .auth-logo { text-align: center; margin-bottom: 30px; }
    .auth-logo-icon { font-size: 64px; margin-bottom: 15px; }
    .auth-logo-text { font-size: 32px; font-weight: bold; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .auth-title { font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 10px; text-align: center; }
    .auth-subtitle { font-size: 14px; color: #6b7280; text-align: center; margin-bottom: 30px; }
    .auth-form { display: flex; flex-direction: column; gap: 20px; }
    .auth-input-group { display: flex; flex-direction: column; gap: 8px; }
    .auth-label { font-size: 14px; font-weight: 600; color: #374151; }
    .auth-input { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.2s; }
    .auth-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
    .auth-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 10px; }
    .auth-btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }
    .auth-btn-primary:hover { transform: translateY(-2px); }
    .auth-switch { text-align: center; margin-top: 20px; font-size: 14px; color: #6b7280; }
    .auth-switch-link { color: #667eea; font-weight: 600; cursor: pointer; text-decoration: none; }
    .auth-info-box { background: #f0f9ff; border-left: 4px solid #3b82f6; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; }
    .auth-info-text { font-size: 13px; color: #1e40af; line-height: 1.5; }
    #app-container { background: #f3f4f6; }
    .tutorial-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .tutorial-card { background: white; border-radius: 20px; padding: 30px; max-width: 400px; width: 100%; text-align: center; animation: slideUp 0.3s ease; }
    .tutorial-emoji { font-size: 80px; margin-bottom: 20px; }
    .tutorial-title { font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 15px; }
    .tutorial-text { font-size: 16px; color: #6b7280; line-height: 1.6; margin-bottom: 25px; }
    .tutorial-progress { height: 6px; background: #e5e7eb; border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
    .tutorial-progress-bar { height: 100%; background: linear-gradient(135deg, #2563eb, #7c3aed); transition: width 0.3s ease; }
    .tutorial-buttons { display: flex; gap: 10px; justify-content: center; }
    .tutorial-btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .tutorial-btn-primary { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; flex: 1; }
    .tutorial-btn-secondary { background: #e5e7eb; color: #6b7280; }
    #header { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .header-left { display: flex; align-items: center; gap: 15px; }
    .menu-btn { font-size: 28px; cursor: pointer; background: none; border: none; color: white; padding: 5px; }
    .logo { font-size: 20px; font-weight: bold; }
    .notification-btn { position: relative; font-size: 24px; background: none; border: none; color: white; cursor: pointer; padding: 5px; }
    .notification-badge { position: absolute; top: 0; right: 0; background: #ef4444; color: white; border-radius: 10px; padding: 2px 6px; font-size: 10px; font-weight: bold; }
    #sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100vh; background: white; z-index: 2000; transition: left 0.3s ease; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; }
    #sidebar.open { left: 0; }
    .sidebar-header { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; padding: 20px; }
    .sidebar-user-info { display: flex; align-items: center; gap: 12px; }
    .sidebar-user-avatar { width: 50px; height: 50px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .sidebar-user-name { font-size: 18px; font-weight: bold; }
    .sidebar-user-email { font-size: 12px; opacity: 0.9; }
    .sidebar-menu { padding: 10px 0; }
    .sidebar-item { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 16px; color: #374151; transition: background 0.2s; }
    .sidebar-item:hover { background: #f3f4f6; }
    .sidebar-item.active { background: #eff6ff; color: #2563eb; font-weight: 600; }
    .sidebar-item.danger { color: #ef4444; }
    #sidebar-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1999; display: none; }
    #sidebar-overlay.show { display: block; }
    #main-content { margin-top: 60px; padding: 20px; min-height: calc(100vh - 130px); }
    .company-selector { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .company-selector select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; background: white; cursor: pointer; color: #1f2937; }
    .add-company-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
    .kpi-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px; }
    .kpi-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .kpi-card.green { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .kpi-card.red { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
    .kpi-card.blue { background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; }
    .kpi-card.purple { background: linear-gradient(135deg, #7c3aed, #6d28d9); color: white; }
    .kpi-label { font-size: 13px; opacity: 0.9; margin-bottom: 8px; }
    .kpi-value { font-size: 24px; font-weight: bold; }
    .section-title { font-size: 20px; font-weight: bold; color: #1f2937; margin-bottom: 15px; }
    .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .card-title { font-size: 16px; font-weight: 600; color: #1f2937; }
    .card-subtitle { font-size: 13px; color: #6b7280; margin-top: 3px; }
    .badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .badge-success { background: #d1fae5; color: #065f46; }
    .badge-danger { background: #fee2e2; color: #991b1b; }
    .stock-btn { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; border: none; padding: 8px 12px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: transform 0.2s; }
    .stock-btn:active { transform: scale(0.95); }
    .sell-btn { width: 100%; margin-top: 10px; padding: 10px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
    .sell-btn:active { transform: scale(0.98); }
    .btn-delete { background: none; border: none; font-size: 20px; cursor: pointer; padding: 5px; color: #ef4444; }
    .fab { position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; border: none; font-size: 28px; cursor: pointer; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4); z-index: 100; display: flex; align-items: center; justify-content: center; }
    .search-bar { margin-bottom: 20px; }
    .search-input { width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px; color: #1f2937; }
    .search-input:focus { outline: none; border-color: #2563eb; }
    .empty-state { text-align: center; padding: 40px 20px; color: #6b7280; }
    .empty-state-emoji { font-size: 64px; margin-bottom: 15px; }
    .empty-state-text { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
    .empty-state-subtext { font-size: 14px; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.6); z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .modal { background: white; border-radius: 16px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
    .modal-header { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-radius: 16px 16px 0 0; }
    .modal-title { font-size: 20px; font-weight: bold; }
    .modal-close { background: none; border: none; color: white; font-size: 28px; cursor: pointer; }
    .modal-body { padding: 20px; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px; }
    .form-input, .form-select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; color: #1f2937; background: white; }
    .modal-footer { padding: 20px; display: flex; gap: 10px; }
    .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; }
    .btn-primary { background: linear-gradient(135deg, #2563eb, #7c3aed); color: white; }
    .btn-secondary { background: #e5e7eb; color: #374151; }
    #bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 999; }
    .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px; cursor: pointer; color: #6b7280; border: none; background: none; }
    .nav-item.active { color: #2563eb; }
    .nav-icon { font-size: 24px; }
    .nav-label { font-size: 11px; font-weight: 600; }
    .stock-alert { background: linear-gradient(135deg, #fee2e2, #fecaca); border-left: 4px solid #ef4444; padding: 12px 15px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .stock-alert-text { flex: 1; font-size: 14px; color: #7f1d1d; }
    .summary-box { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .summary-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f3f4f6; }
    .summary-item:last-child { border-bottom: none; }
    .summary-label { font-size: 14px; color: #6b7280; }
    .summary-value { font-size: 16px; font-weight: 600; }
    .summary-value.green { color: #10b981; }
    .summary-value.red { color: #ef4444; }
    .chart-container { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .chart-title { font-size: 18px; font-weight: bold; color: #1f2937; margin-bottom: 15px; }
    .report-btn { width: 100%; padding: 14px; margin-bottom: 10px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.2s; }
    .report-btn:active { transform: scale(0.98); }
    .btn-pdf { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
    .btn-excel { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .month-selector { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .month-selector select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; background: white; color: #1f2937; cursor: pointer; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    var app={isAuth:false,user:null,authScreen:"login",view:"dashboard",sidebar:false,modal:null,search:"",tutorial:false,step:0,companyId:null,companies:[],transactions:[],products:[],clients:[],selectedMonth:new Date().getMonth(),selectedYear:new Date().getFullYear(),selectedProduct:null};
    var steps=[{e:"üëã",t:"¬°Bienvenido a AdminPro!",d:"Tu soluci√≥n completa para gestionar m√∫ltiples empresas desde un solo lugar."},{e:"üè¢",t:"Gesti√≥n Multi-Empresa",d:"Puedes crear y administrar varias empresas. Cambia entre ellas f√°cilmente."},{e:"üí∞",t:"Control de Finanzas",d:"Registra todos tus ingresos y egresos. Visualiza tu balance en tiempo real."},{e:"üì¶",t:"Inventario Inteligente",d:"Administra tus productos con alertas autom√°ticas de stock bajo."},{e:"üë•",t:"Base de Clientes",d:"Mant√©n un registro completo de tus clientes y el total de sus compras."},{e:"üìä",t:"Reportes y Gr√°ficos",d:"Genera informes en PDF y Excel. Visualiza gr√°ficos de tu desempe√±o mensual."},{e:"üöÄ",t:"¬°Todo Listo!",d:"Ya conoces lo b√°sico. Comienza creando tu primera empresa. ¬°√âxito!"}];
    
    function save(){if(app.user){localStorage.setItem("adminpro_user",JSON.stringify(app.user));localStorage.setItem("adminpro_auth","1");var d={companies:app.companies,transactions:app.transactions,products:app.products,clients:app.clients,companyId:app.companyId,done:!app.tutorial};localStorage.setItem("adminpro_"+app.user.id,JSON.stringify(d));}}
    
    function load(){try{var a=localStorage.getItem("adminpro_auth");var u=localStorage.getItem("adminpro_user");if(a==="1"&&u){app.isAuth=true;app.user=JSON.parse(u);var d=localStorage.getItem("adminpro_"+app.user.id);if(d){var o=JSON.parse(d);app.companies=o.companies||[];app.transactions=o.transactions||[];app.products=o.products||[];app.clients=o.clients||[];app.companyId=o.companyId;app.tutorial=!o.done;}else{init();}if(!app.companyId&&app.companies.length>0)app.companyId=app.companies[0].id;return true;}}catch(e){}return false;}
    
    function register(e){e.preventDefault();var n=document.getElementById("rName").value.trim();var m=document.getElementById("rEmail").value.trim();var p=document.getElementById("rPass").value;var c=document.getElementById("rConf").value;if(!n||!m||!p){alert("‚ö†Ô∏è Completa todos los campos");return;}if(p.length<6){alert("‚ö†Ô∏è Contrase√±a m√≠nimo 6 caracteres");return;}if(p!==c){alert("‚ö†Ô∏è Las contrase√±as no coinciden");return;}var users=JSON.parse(localStorage.getItem("adminpro_users")||"[]");if(users.find(function(u){return u.email===m;})){alert("‚ö†Ô∏è Email ya registrado");return;}var user={id:Date.now(),name:n,email:m,password:btoa(p),created:new Date().toISOString()};users.push(user);localStorage.setItem("adminpro_users",JSON.stringify(users));app.user=user;app.isAuth=true;save();init();alert("‚úÖ Registro exitoso");render();}
    
    function login(e){e.preventDefault();var m=document.getElementById("lEmail").value.trim();var p=document.getElementById("lPass").value;if(!m||!p){alert("‚ö†Ô∏è Completa todos los campos");return;}var users=JSON.parse(localStorage.getItem("adminpro_users")||"[]");var user=users.find(function(u){return u.email===m&&u.password===btoa(p);});if(!user){alert("‚ùå Email o contrase√±a incorrectos");return;}app.user=user;app.isAuth=true;save();load();alert("‚úÖ Bienvenido");render();}
    
    function logout(){if(confirm("¬øCerrar sesi√≥n?")){app.isAuth=false;app.user=null;localStorage.removeItem("adminpro_auth");localStorage.removeItem("adminpro_user");app.sidebar=false;alert("üëã Sesi√≥n cerrada");render();}}
    
    function switchAuth(s){app.authScreen=s;render();}
    
    function init(){var c={id:Date.now(),name:"Mi Empresa",created:new Date().toISOString()};app.companies=[c];app.companyId=c.id;app.transactions=[];app.products=[];app.clients=[];app.tutorial=true;app.step=0;save();}
    
    function getData(){if(!app.companyId)return{transactions:[],products:[],clients:[]};return{transactions:app.transactions.filter(function(t){return t.companyId===app.companyId;}),products:app.products.filter(function(p){return p.companyId===app.companyId;}),clients:app.clients.filter(function(c){return c.companyId===app.companyId;})};}
    
    function getMonthData(){var data=getData();var month=app.selectedMonth;var year=app.selectedYear;return{transactions:data.transactions.filter(function(t){var d=new Date(t.date);return d.getMonth()===month&&d.getFullYear()===year;}),products:data.products,clients:data.clients};}
    
    function money(a){return "$"+Math.abs(a).toLocaleString("es-CL");}
    
    function totals(){var d=getData();var ing=d.transactions.filter(function(t){return t.type==="Ingreso";}).reduce(function(s,t){return s+t.amount;},0);var egr=d.transactions.filter(function(t){return t.type==="Egreso";}).reduce(function(s,t){return s+Math.abs(t.amount);},0);return{ing:ing,egr:egr,bal:ing-egr,prod:d.products.length};}
    
    function monthTotals(){var d=getMonthData();var ing=d.transactions.filter(function(t){return t.type==="Ingreso";}).reduce(function(s,t){return s+t.amount;},0);var egr=d.transactions.filter(function(t){return t.type==="Egreso";}).reduce(function(s,t){return s+Math.abs(t.amount);},0);return{ing:ing,egr:egr,bal:ing-egr,trans:d.transactions.length};}
    
    function lowStock(){return getData().products.filter(function(p){return p.stock<10;});}
    
    function delTrans(id){if(confirm("¬øEliminar transacci√≥n?")){app.transactions=app.transactions.filter(function(t){return t.id!==id;});save();alert("‚úÖ Eliminada");render();}}
    
    function delProd(id){if(confirm("¬øEliminar producto?")){app.products=app.products.filter(function(p){return p.id!==id;});save();alert("‚úÖ Eliminado");render();}}
    
    function delClient(id){if(confirm("¬øEliminar cliente?")){app.clients=app.clients.filter(function(c){return c.id!==id;});save();alert("‚úÖ Eliminado");render();}}
    
    function render(){var el=document.getElementById("app");el.innerHTML="";if(!app.isAuth){el.appendChild(authUI());return;}el.innerHTML="<div id=\"cont\"></div>";var c=document.getElementById("cont");if(app.tutorial)c.appendChild(tutUI());c.appendChild(headUI());c.appendChild(sideUI());c.appendChild(overlayUI());c.appendChild(mainUI());c.appendChild(navUI());if(app.modal)c.appendChild(modalUI());}
    
    function authUI(){var d=document.createElement("div");d.className="auth-container";if(app.authScreen==="login"){d.innerHTML="<div class=\"auth-card\"><div class=\"auth-logo\"><div class=\"auth-logo-icon\">üè¢</div><div class=\"auth-logo-text\">AdminPro</div></div><div class=\"auth-title\">Iniciar Sesi√≥n</div><div class=\"auth-subtitle\">Ingresa a tu cuenta</div><form class=\"auth-form\" onsubmit=\"login(event)\"><div class=\"auth-input-group\"><label class=\"auth-label\">Email</label><input type=\"email\" class=\"auth-input\" id=\"lEmail\" required></div><div class=\"auth-input-group\"><label class=\"auth-label\">Contrase√±a</label><input type=\"password\" class=\"auth-input\" id=\"lPass\" required></div><button type=\"submit\" class=\"auth-btn auth-btn-primary\">Entrar</button></form><div class=\"auth-switch\">¬øNo tienes cuenta? <a class=\"auth-switch-link\" onclick=\"switchAuth('register')\">Reg√≠strate</a></div></div>";}else{d.innerHTML="<div class=\"auth-card\"><div class=\"auth-logo\"><div class=\"auth-logo-icon\">üè¢</div><div class=\"auth-logo-text\">AdminPro</div></div><div class=\"auth-title\">Crear Cuenta</div><div class=\"auth-subtitle\">Registra tu empresa</div><div class=\"auth-info-box\"><div class=\"auth-info-text\">üîí Tu informaci√≥n est√° segura</div></div><form class=\"auth-form\" onsubmit=\"register(event)\"><div class=\"auth-input-group\"><label class=\"auth-label\">Nombre</label><input type=\"text\" class=\"auth-input\" id=\"rName\" required></div><div class=\"auth-input-group\"><label class=\"auth-label\">Email</label><input type=\"email\" class=\"auth-input\" id=\"rEmail\" required></div><div class=\"auth-input-group\"><label class=\"auth-label\">Contrase√±a</label><input type=\"password\" class=\"auth-input\" id=\"rPass\" minlength=\"6\" required></div><div class=\"auth-input-group\"><label class=\"auth-label\">Confirmar</label><input type=\"password\" class=\"auth-input\" id=\"rConf\" minlength=\"6\" required></div><button type=\"submit\" class=\"auth-btn auth-btn-primary\">Crear Cuenta</button></form><div class=\"auth-switch\">¬øYa tienes cuenta? <a class=\"auth-switch-link\" onclick=\"switchAuth('login')\">Inicia sesi√≥n</a></div></div>";}return d;}
    
    function tutUI(){var d=document.createElement("div");d.className="tutorial-overlay";var s=steps[app.step];var p=((app.step+1)/steps.length)*100;var bp=app.step>0?"<button class=\"tutorial-btn tutorial-btn-secondary\" onclick=\"prevStep()\">Anterior</button>":"";var bs=app.step<steps.length-1?"<button class=\"tutorial-btn tutorial-btn-secondary\" onclick=\"skipTut()\">Omitir</button>":"";var bn=app.step<steps.length-1?"<button class=\"tutorial-btn tutorial-btn-primary\" onclick=\"nextStep()\">Siguiente</button>":"<button class=\"tutorial-btn tutorial-btn-primary\" onclick=\"doneTut()\">¬°Comenzar!</button>";d.innerHTML="<div class=\"tutorial-card\"><div class=\"tutorial-emoji\">"+s.e+"</div><div class=\"tutorial-title\">"+s.t+"</div><div class=\"tutorial-text\">"+s.d+"</div><div class=\"tutorial-progress\"><div class=\"tutorial-progress-bar\" style=\"width:"+p+"%\"></div></div><div class=\"tutorial-buttons\">"+bp+bs+bn+"</div></div>";return d;}
    function nextStep(){if(app.step<steps.length-1){app.step++;render();}}
    function prevStep(){if(app.step>0){app.step--;render();}}
    function skipTut(){app.tutorial=false;save();render();}
    function doneTut(){app.tutorial=false;save();render();}
    function restartTut(){app.step=0;app.tutorial=true;app.sidebar=false;render();}
    function headUI(){var d=document.createElement("div");d.id="header";var ls=lowStock().length;var b=ls>0?"<span class=\"notification-badge\">"+ls+"</span>":"";d.innerHTML="<div class=\"header-left\"><button class=\"menu-btn\" onclick=\"toggleSide()\">‚ò∞</button><div class=\"logo\">AdminPro</div></div><button class=\"notification-btn\" onclick=\"alert('üì¶ "+ls+" productos con stock bajo')\">üîî"+b+"</button>";return d;}
    function sideUI(){var d=document.createElement("div");d.id="sidebar";d.className=app.sidebar?"open":"";var items=[{id:"dashboard",i:"üìä",l:"Dashboard"},{id:"finanzas",i:"üí∞",l:"Finanzas"},{id:"inventario",i:"üì¶",l:"Inventario"},{id:"clientes",i:"üë•",l:"Clientes"},{id:"reportes",i:"üìà",l:"Reportes"}];var menu=items.map(function(it){var a=app.view===it.id?"active":"";return"<div class=\"sidebar-item "+a+"\" onclick=\"goTo('"+it.id+"')\">"+it.i+" "+it.l+"</div>";}).join("");d.innerHTML="<div class=\"sidebar-header\"><div class=\"sidebar-user-info\"><div class=\"sidebar-user-avatar\">üë§</div><div><div class=\"sidebar-user-name\">"+app.user.name+"</div><div class=\"sidebar-user-email\">"+app.user.email+"</div></div></div></div><div class=\"sidebar-menu\">"+menu+"<div class=\"sidebar-item\" onclick=\"restartTut()\">üéì Ver Tutorial</div><div class=\"sidebar-item danger\" onclick=\"logout()\">üö™ Cerrar Sesi√≥n</div></div>";return d;}
    function overlayUI(){var d=document.createElement("div");d.id="sidebar-overlay";d.className=app.sidebar?"show":"";d.onclick=function(){toggleSide();};return d;}
    function toggleSide(){app.sidebar=!app.sidebar;render();}
    function mainUI(){var d=document.createElement("div");d.id="main-content";d.appendChild(compUI());if(app.view==="dashboard")d.appendChild(dashUI());else if(app.view==="finanzas")d.appendChild(finUI());else if(app.view==="inventario")d.appendChild(invUI());else if(app.view==="clientes")d.appendChild(cliUI());else if(app.view==="reportes")d.appendChild(repUI());return d;}
    function compUI(){var d=document.createElement("div");d.className="company-selector";var opts=app.companies.map(function(c){var s=c.id===app.companyId?"selected":"";return"<option value=\""+c.id+"\" "+s+">"+c.name+"</option>";}).join("");d.innerHTML="<select onchange=\"changeComp(parseInt(this.value))\">"+opts+"</select><button class=\"add-company-btn\" onclick=\"openMod('company')\">+ Agregar Nueva Empresa</button>";return d;}
    function changeComp(id){app.companyId=id;save();render();}
    function dashUI(){var d=document.createElement("div");var t=totals();var ls=lowStock();var data=getData();var rec=data.transactions.slice(-5).reverse();var h="<div class=\"kpi-grid\"><div class=\"kpi-card green\"><div class=\"kpi-label\">Total Ingresos</div><div class=\"kpi-value\">"+money(t.ing)+"</div></div><div class=\"kpi-card red\"><div class=\"kpi-label\">Total Egresos</div><div class=\"kpi-value\">"+money(t.egr)+"</div></div><div class=\"kpi-card blue\"><div class=\"kpi-label\">Balance Neto</div><div class=\"kpi-value\">"+money(t.bal)+"</div></div><div class=\"kpi-card purple\"><div class=\"kpi-label\">Total Productos</div><div class=\"kpi-value\">"+t.prod+"</div></div></div>";if(ls.length>0){h+="<div class=\"section-title\">‚ö†Ô∏è Stock Bajo</div>";ls.forEach(function(p){h+="<div class=\"stock-alert\"><div>‚ö†Ô∏è</div><div class=\"stock-alert-text\"><strong>"+p.name+"</strong> solo tiene "+p.stock+" unidades</div></div>";});}h+="<div class=\"section-title\">üìù √öltimas Transacciones</div>";if(rec.length>0){rec.forEach(function(t){var b=t.type==="Ingreso"?"badge-success":"badge-danger";h+="<div class=\"card\"><div class=\"card-header\"><div><div class=\"card-title\">"+t.description+"</div><div class=\"card-subtitle\">"+t.date+"</div></div><div><span class=\"badge "+b+"\">"+t.type+"</span></div></div><div class=\"card-title\">"+money(t.amount)+"</div></div>";});}else{h+="<div class=\"empty-state\"><div class=\"empty-state-emoji\">üíº</div><div class=\"empty-state-text\">No hay transacciones</div><div class=\"empty-state-subtext\">Agrega tu primera transacci√≥n</div></div>";}d.innerHTML=h;return d;}
    function finUI(){var d=document.createElement("div");var data=getData();var t=totals();var bc=t.bal>=0?"green":"red";var h="<div class=\"summary-box\"><div class=\"summary-item\"><span class=\"summary-label\">Total Ingresos</span><span class=\"summary-value green\">"+money(t.ing)+"</span></div><div class=\"summary-item\"><span class=\"summary-label\">Total Egresos</span><span class=\"summary-value red\">"+money(t.egr)+"</span></div><div class=\"summary-item\"><span class=\"summary-label\">Balance</span><span class=\"summary-value "+bc+"\">"+money(t.bal)+"</span></div></div><div class=\"section-title\">üí∞ Todas las Transacciones</div>";if(data.transactions.length>0){data.transactions.slice().reverse().forEach(function(t){var b=t.type==="Ingreso"?"badge-success":"badge-danger";h+="<div class=\"card\"><div class=\"card-header\"><div><div class=\"card-title\">"+t.description+"</div><div class=\"card-subtitle\">"+t.category+" ‚Ä¢ "+t.date+"</div></div><button class=\"btn-delete\" onclick=\"delTrans("+t.id+")\">üóëÔ∏è</button></div><div style=\"display:flex;justify-content:space-between;align-items:center;margin-top:10px;\"><span class=\"badge "+b+"\">"+t.type+"</span><span class=\"card-title\">"+money(t.amount)+"</span></div></div>";});}else{h+="<div class=\"empty-state\"><div class=\"empty-state-emoji\">üí∏</div><div class=\"empty-state-text\">No hay transacciones</div><div class=\"empty-state-subtext\">Presiona + para agregar</div></div>";}d.innerHTML=h;var f=document.createElement("button");f.className="fab";f.innerHTML="+";f.onclick=function(){openMod("transaction");};d.appendChild(f);return d;}
    function invUI(){var d=document.createElement("div");var data=getData();var filt=data.products.filter(function(p){return p.name.toLowerCase().includes(app.search.toLowerCase())||p.sku.toLowerCase().includes(app.search.toLowerCase());});var h="<div class=\"search-bar\"><input type=\"text\" class=\"search-input\" placeholder=\"üîç Buscar...\" value=\""+app.search+"\" oninput=\"handleSearch(this.value)\"></div><div class=\"section-title\">üì¶ Productos ("+filt.length+")</div>";if(filt.length>0){filt.forEach(function(p){var b=p.stock<10?"badge-danger":"badge-success";h+="<div class=\"card\"><div class=\"card-header\"><div><div class=\"card-title\">"+p.name+"</div><div class=\"card-subtitle\">SKU: "+p.sku+"</div></div><button class=\"btn-delete\" onclick=\"delProd("+p.id+")\">üóëÔ∏è</button></div><div style=\"display:flex;justify-content:space-between;align-items:center;margin-top:10px;\"><div style=\"display:flex;align-items:center;gap:10px;\"><span class=\"badge "+b+"\">Stock: "+p.stock+"</span><button class=\"stock-btn\" onclick=\"changeStock("+p.id+",-1)\">‚ûñ</button><button class=\"stock-btn\" onclick=\"changeStock("+p.id+",1)\">‚ûï</button></div><span class=\"card-title\">"+money(p.price)+"</span></div><button class=\"sell-btn\" onclick=\"openMod('sale',"+p.id+")\">üí∞ Vender</button></div>";});}else{var txt=app.search?"No se encontraron productos":"No hay productos";var sub=app.search?"Intenta con otro t√©rmino":"Presiona + para agregar";h+="<div class=\"empty-state\"><div class=\"empty-state-emoji\">üì¶</div><div class=\"empty-state-text\">"+txt+"</div><div class=\"empty-state-subtext\">"+sub+"</div></div>";}d.innerHTML=h;var f=document.createElement("button");f.className="fab";f.innerHTML="+";f.onclick=function(){openMod("product");};d.appendChild(f);return d;}
    function handleSearch(v){app.search=v;render();}
    function cliUI(){var d=document.createElement("div");var data=getData();var h="<div class=\"section-title\">üë• Clientes ("+data.clients.length+")</div>";if(data.clients.length>0){data.clients.forEach(function(c){h+="<div class=\"card\"><div class=\"card-header\"><div><div class=\"card-title\">"+c.name+"</div><div class=\"card-subtitle\">"+c.email+"</div><div class=\"card-subtitle\">üì± "+c.phone+"</div></div><button class=\"btn-delete\" onclick=\"delClient("+c.id+")\">üóëÔ∏è</button></div><div style=\"display:flex;justify-content:space-between;align-items:center;margin-top:10px;\"><span style=\"font-size:13px;color:#6b7280;\">Total gastado</span><span class=\"card-title\" style=\"color:#10b981;\">"+money(c.total)+"</span></div></div>";});}else{h+="<div class=\"empty-state\"><div class=\"empty-state-emoji\">üë§</div><div class=\"empty-state-text\">No hay clientes</div><div class=\"empty-state-subtext\">Presiona + para agregar</div></div>";}d.innerHTML=h;var f=document.createElement("button");f.className="fab";f.innerHTML="+";f.onclick=function(){openMod("client");};d.appendChild(f);return d;}
    function repUI(){var d=document.createElement("div");var months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var monthOpts=months.map(function(m,i){var s=i===app.selectedMonth?"selected":"";return"<option value=\""+i+"\" "+s+">"+m+" "+app.selectedYear+"</option>";}).join("");var h="<div class=\"month-selector\"><select onchange=\"changeMonth(parseInt(this.value))\">"+monthOpts+"</select></div>";h+="<div class=\"section-title\">üìä Gr√°ficos del Mes</div>";h+="<div class=\"chart-container\"><div class=\"chart-title\">Balance Mensual</div><canvas id=\"balanceChart\" width=\"400\" height=\"200\"></canvas></div>";h+="<div class=\"chart-container\"><div class=\"chart-title\">Ingresos vs Egresos</div><canvas id=\"incomeChart\" width=\"400\" height=\"200\"></canvas></div>";h+="<div class=\"chart-container\"><div class=\"chart-title\">Top 5 Productos por Stock</div><canvas id=\"stockChart\" width=\"400\" height=\"200\"></canvas></div>";h+="<div class=\"section-title\">üìÑ Descargar Informes</div>";h+="<button class=\"report-btn btn-pdf\" onclick=\"genPDF()\">üìë Descargar Informe Completo PDF</button>";h+="<button class=\"report-btn btn-excel\" onclick=\"genExcel()\">üìä Descargar Informe Completo Excel</button>";d.innerHTML=h;setTimeout(function(){drawCharts();},100);return d;}
    function changeMonth(m){app.selectedMonth=m;render();}
    function drawCharts(){var data=getMonthData();var t=monthTotals();if(document.getElementById("balanceChart")){var ctx1=document.getElementById("balanceChart").getContext("2d");new Chart(ctx1,{type:"bar",data:{labels:["Ingresos","Egresos","Balance"],datasets:[{label:"Monto ($)",data:[t.ing,t.egr,t.bal],backgroundColor:["#10b981","#ef4444","#2563eb"]}]},options:{responsive:true,plugins:{legend:{display:false}}}});}if(document.getElementById("incomeChart")){var ctx2=document.getElementById("incomeChart").getContext("2d");new Chart(ctx2,{type:"doughnut",data:{labels:["Ingresos","Egresos"],datasets:[{data:[t.ing,t.egr],backgroundColor:["#10b981","#ef4444"]}]},options:{responsive:true}});}if(document.getElementById("stockChart")){var top5=data.products.sort(function(a,b){return b.stock-a.stock;}).slice(0,5);var ctx3=document.getElementById("stockChart").getContext("2d");new Chart(ctx3,{type:"horizontalBar",data:{labels:top5.map(function(p){return p.name;}),datasets:[{label:"Stock",data:top5.map(function(p){return p.stock;}),backgroundColor:"#7c3aed"}]},options:{responsive:true,indexAxis:"y"}});}}
    function genPDF(){var {jsPDF}=window.jspdf;var doc=new jsPDF();var data=getMonthData();var t=monthTotals();var months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var comp=app.companies.find(function(c){return c.id===app.companyId;});doc.setFontSize(20);doc.text("Informe Mensual - "+comp.name,20,20);doc.setFontSize(12);doc.text("Periodo: "+months[app.selectedMonth]+" "+app.selectedYear,20,30);doc.text("Generado: "+new Date().toLocaleDateString(),20,40);doc.setFontSize(16);doc.text("RESUMEN FINANCIERO",20,55);doc.setFontSize(12);doc.text("Total Ingresos: "+money(t.ing),20,65);doc.text("Total Egresos: "+money(t.egr),20,75);doc.text("Balance Neto: "+money(t.bal),20,85);doc.text("Transacciones del mes: "+t.trans,20,95);doc.setFontSize(16);doc.text("INVENTARIO",20,110);doc.setFontSize(12);doc.text("Total Productos: "+data.products.length,20,120);var lowS=data.products.filter(function(p){return p.stock<10;});doc.text("Productos con stock bajo: "+lowS.length,20,130);doc.setFontSize(16);doc.text("CLIENTES",20,145);doc.setFontSize(12);doc.text("Total Clientes: "+data.clients.length,20,155);var totalVentas=data.clients.reduce(function(s,c){return s+c.total;},0);doc.text("Ventas Totales: "+money(totalVentas),20,165);doc.setFontSize(16);doc.text("TRANSACCIONES DEL MES",20,180);var y=190;data.transactions.slice(0,10).forEach(function(tr,i){if(y>270){doc.addPage();y=20;}doc.setFontSize(10);doc.text((i+1)+". "+tr.description+" - "+money(tr.amount)+" ("+tr.type+")",20,y);y+=10;});doc.save("Informe_"+months[app.selectedMonth]+"_"+app.selectedYear+".pdf");alert("‚úÖ PDF descargado");}
    function genExcel(){var data=getMonthData();var t=monthTotals();var months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var comp=app.companies.find(function(c){return c.id===app.companyId;});var wb=XLSX.utils.book_new();var resumen=[["INFORME MENSUAL - "+comp.name],["Periodo",months[app.selectedMonth]+" "+app.selectedYear],["Generado",new Date().toLocaleDateString()],[""],["RESUMEN FINANCIERO"],["Total Ingresos",t.ing],["Total Egresos",t.egr],["Balance Neto",t.bal],["Transacciones",t.trans],[""],["INVENTARIO"],["Total Productos",data.products.length],["Productos stock bajo",data.products.filter(function(p){return p.stock<10;}).length],[""],["CLIENTES"],["Total Clientes",data.clients.length],["Ventas Totales",data.clients.reduce(function(s,c){return s+c.total;},0)]];var ws1=XLSX.utils.aoa_to_sheet(resumen);XLSX.utils.book_append_sheet(wb,ws1,"Resumen");var transData=[["Fecha","Tipo","Categor√≠a","Descripci√≥n","Monto"]];data.transactions.forEach(function(tr){transData.push([tr.date,tr.type,tr.category,tr.description,tr.amount]);});var ws2=XLSX.utils.aoa_to_sheet(transData);XLSX.utils.book_append_sheet(wb,ws2,"Transacciones");var prodData=[["SKU","Nombre","Precio","Stock"]];data.products.forEach(function(p){prodData.push([p.sku,p.name,p.price,p.stock]);});var ws3=XLSX.utils.aoa_to_sheet(prodData);XLSX.utils.book_append_sheet(wb,ws3,"Inventario");var cliData=[["Nombre","Email","Tel√©fono","Total Gastado"]];data.clients.forEach(function(c){cliData.push([c.name,c.email,c.phone,c.total]);});var ws4=XLSX.utils.aoa_to_sheet(cliData);XLSX.utils.book_append_sheet(wb,ws4,"Clientes");XLSX.writeFile(wb,"Informe_"+months[app.selectedMonth]+"_"+app.selectedYear+".xlsx");alert("‚úÖ Excel descargado");}
    function navUI(){var d=document.createElement("div");d.id="bottom-nav";var items=[{id:"dashboard",i:"üìä",l:"Dashboard"},{id:"finanzas",i:"üí∞",l:"Finanzas"},{id:"inventario",i:"üì¶",l:"Inventario"},{id:"clientes",i:"üë•",l:"Clientes"},{id:"reportes",i:"üìà",l:"Reportes"}];d.innerHTML=items.map(function(it){var a=app.view===it.id?"active":"";return"<button class=\"nav-item "+a+"\" onclick=\"goTo('"+it.id+"')\"><div class=\"nav-icon\">"+it.i+"</div><div class=\"nav-label\">"+it.l+"</div></button>";}).join("");return d;}
    function goTo(v){app.view=v;app.sidebar=false;app.search="";render();}
    function modalUI(){var d=document.createElement("div");d.className="modal-overlay";d.onclick=function(e){if(e.target===d)closeMod();};var m="";if(app.modal==="company"){m="<div class=\"modal\"><div class=\"modal-header\"><div class=\"modal-title\">üè¢ Nueva Empresa</div><button class=\"modal-close\" onclick=\"closeMod()\">√ó</button></div><form onsubmit=\"addComp(event)\"><div class=\"modal-body\"><div class=\"form-group\"><label class=\"form-label\">Nombre *</label><input type=\"text\" class=\"form-input\" id=\"cName\" required></div></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeMod()\">Cancelar</button><button type=\"submit\" class=\"btn btn-primary\">Guardar</button></div></form></div>";}else if(app.modal==="transaction"){m="<div class=\"modal\"><div class=\"modal-header\"><div class=\"modal-title\">üí∞ Nueva Transacci√≥n</div><button class=\"modal-close\" onclick=\"closeMod()\">√ó</button></div><form onsubmit=\"addTrans(event)\"><div class=\"modal-body\"><div class=\"form-group\"><label class=\"form-label\">Tipo *</label><select class=\"form-select\" id=\"tType\" required><option value=\"Ingreso\">Ingreso</option><option value=\"Egreso\">Egreso</option></select></div><div class=\"form-group\"><label class=\"form-label\">Categor√≠a *</label><input type=\"text\" class=\"form-input\" id=\"tCat\" required></div><div class=\"form-group\"><label class=\"form-label\">Descripci√≥n *</label><input type=\"text\" class=\"form-input\" id=\"tDesc\" required></div><div class=\"form-group\"><label class=\"form-label\">Monto *</label><input type=\"number\" class=\"form-input\" id=\"tAmt\" required min=\"0\"></div><div class=\"form-group\"><label class=\"form-label\">Fecha *</label><input type=\"date\" class=\"form-input\" id=\"tDate\" required></div></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeMod()\">Cancelar</button><button type=\"submit\" class=\"btn btn-primary\">Guardar</button></div></form></div>";}else if(app.modal==="product"){m="<div class=\"modal\"><div class=\"modal-header\"><div class=\"modal-title\">üì¶ Nuevo Producto</div><button class=\"modal-close\" onclick=\"closeMod()\">√ó</button></div><form onsubmit=\"addProd(event)\"><div class=\"modal-body\"><div class=\"form-group\"><label class=\"form-label\">SKU *</label><input type=\"text\" class=\"form-input\" id=\"pSku\" required></div><div class=\"form-group\"><label class=\"form-label\">Nombre *</label><input type=\"text\" class=\"form-input\" id=\"pName\" required></div><div class=\"form-group\"><label class=\"form-label\">Precio *</label><input type=\"number\" class=\"form-input\" id=\"pPrice\" required min=\"0\"></div><div class=\"form-group\"><label class=\"form-label\">Stock *</label><input type=\"number\" class=\"form-input\" id=\"pStock\" required min=\"0\"></div></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeMod()\">Cancelar</button><button type=\"submit\" class=\"btn btn-primary\">Guardar</button></div></form></div>";}else if(app.modal==="client"){m="<div class=\"modal\"><div class=\"modal-header\"><div class=\"modal-title\">üë§ Nuevo Cliente</div><button class=\"modal-close\" onclick=\"closeMod()\">√ó</button></div><form onsubmit=\"addCli(event)\"><div class=\"modal-body\"><div class=\"form-group\"><label class=\"form-label\">Nombre *</label><input type=\"text\" class=\"form-input\" id=\"clName\" required></div><div class=\"form-group\"><label class=\"form-label\">Email *</label><input type=\"email\" class=\"form-input\" id=\"clEmail\" required></div><div class=\"form-group\"><label class=\"form-label\">Tel√©fono *</label><input type=\"tel\" class=\"form-input\" id=\"clPhone\" required></div><div class=\"form-group\"><label class=\"form-label\">Total Gastado</label><input type=\"number\" class=\"form-input\" id=\"clTotal\" min=\"0\" value=\"0\"></div></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeMod()\">Cancelar</button><button type=\"submit\" class=\"btn btn-primary\">Guardar</button></div></form></div>";}else if(app.modal==="sale"){var prod=app.products.find(function(p){return p.id===app.selectedProduct;});var clients=getData().clients;var clientOpts=clients.map(function(c){return"<option value=\""+c.id+"\">"+c.name+"</option>";}).join("");m="<div class=\"modal\"><div class=\"modal-header\"><div class=\"modal-title\">üí∞ Registrar Venta</div><button class=\"modal-close\" onclick=\"closeMod()\">√ó</button></div><form onsubmit=\"makeSale(event)\"><div class=\"modal-body\"><div class=\"form-group\"><label class=\"form-label\">Producto</label><input type=\"text\" class=\"form-input\" value=\""+prod.name+"\" disabled></div><div class=\"form-group\"><label class=\"form-label\">Precio Unitario</label><input type=\"text\" class=\"form-input\" value=\""+money(prod.price)+"\" disabled></div><div class=\"form-group\"><label class=\"form-label\">Cantidad *</label><input type=\"number\" class=\"form-input\" id=\"sQty\" required min=\"1\" max=\""+prod.stock+"\" value=\"1\"></div><div class=\"form-group\"><label class=\"form-label\">Cliente *</label><select class=\"form-select\" id=\"sClient\" required><option value=\"\">Seleccionar cliente</option>"+clientOpts+"</select></div><div class=\"form-group\"><label class=\"form-label\">M√©todo de Pago *</label><select class=\"form-select\" id=\"sMethod\" required><option value=\"Efectivo\">Efectivo</option><option value=\"Tarjeta\">Tarjeta</option><option value=\"Transferencia\">Transferencia</option></select></div></div><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeMod()\">Cancelar</button><button type=\"submit\" class=\"btn btn-primary\">Registrar Venta</button></div></form></div>";}d.innerHTML=m;return d;}
    function openMod(t){app.modal=t;render();if(t==="transaction"){setTimeout(function(){var d=document.getElementById("tDate");if(d)d.valueAsDate=new Date();},0);}}
    function closeMod(){app.modal=null;render();}
    function addComp(e){e.preventDefault();var n=document.getElementById("cName").value;if(!n.trim()){alert("‚ö†Ô∏è Nombre requerido");return;}var c={id:Date.now(),name:n.trim(),created:new Date().toISOString()};app.companies.push(c);app.companyId=c.id;save();closeMod();alert("‚úÖ Empresa creada");render();}
    function addTrans(e){e.preventDefault();var ty=document.getElementById("tType").value;var cat=document.getElementById("tCat").value;var desc=document.getElementById("tDesc").value;var amt=parseFloat(document.getElementById("tAmt").value);var dt=document.getElementById("tDate").value;if(!desc.trim()||!amt||!dt){alert("‚ö†Ô∏è Completa todos los campos");return;}var t={id:Date.now(),companyId:app.companyId,type:ty,category:cat.trim(),description:desc.trim(),amount:ty==="Egreso"?-Math.abs(amt):Math.abs(amt),date:dt};app.transactions.push(t);save();closeMod();alert("‚úÖ Transacci√≥n guardada");render();}
    function addProd(e){e.preventDefault();var sku=document.getElementById("pSku").value;var name=document.getElementById("pName").value;var price=parseFloat(document.getElementById("pPrice").value);var stock=parseInt(document.getElementById("pStock").value);if(!sku.trim()||!name.trim()||!price||stock<0){alert("‚ö†Ô∏è Completa todos los campos");return;}var p={id:Date.now(),companyId:app.companyId,sku:sku.trim(),name:name.trim(),price:price,stock:stock};app.products.push(p);save();closeMod();alert("‚úÖ Producto guardado");render();}
    function addCli(e){e.preventDefault();var name=document.getElementById("clName").value;var email=document.getElementById("clEmail").value;var phone=document.getElementById("clPhone").value;var total=parseFloat(document.getElementById("clTotal").value)||0;if(!name.trim()||!email.trim()||!phone.trim()){alert("‚ö†Ô∏è Completa todos los campos");return;}var c={id:Date.now(),companyId:app.companyId,name:name.trim(),email:email.trim(),phone:phone.trim(),total:total};app.clients.push(c);save();closeMod();alert("‚úÖ Cliente guardado");render();}
    if(load()){render();}else{render();}
  </script>
</body>
</html>